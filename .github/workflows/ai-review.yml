name: AI Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write
  checks: write

jobs:
  ai-review:
    # Block fork PRs for security (self-hosted runners should not run untrusted code)
    if: github.event.pull_request.head.repo.full_name == github.repository

    uses: oddessentials/odd-ai-reviewers/.github/workflows/ai-review.yml@main
    with:
      target_repo: ${{ github.repository }}
      target_ref: ${{ github.sha }}
      pr_number: ${{ github.event.pull_request.number }}
      # runs_on: '["self-hosted", "linux"]'
      # runs_on: '["ubuntu-latest"]' if default and not needed but here to be explicit

    secrets:
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      # Optional w/ OSCR:
      # OLLAMA_BASE_URL: ${{ secrets.OLLAMA_BASE_URL }}
      # Optional overrides:
      # LOCAL_LLM_NUM_CTX: "32768"     # Larger context (more RAM)
      # LOCAL_LLM_TIMEOUT: "180000"    # 3 min timeout (slower models)